<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../bower_components/highcharts-chart/highcharts-chart.html">
<link rel="import" href="app-data.html">
<link rel="import" href="shared-styles.html">

<dom-module id="secret-graphs">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }

       p {
        text-align: justify;
        font-size: 12px;
      }

      .align-left {
        float: left;
      }

      .align-right {
        float: right;
      }

      .container {
        padding-bottom: 20px;
      }

    </style>

    <!--Persistent user storage-->
    <iron-localstorage 
        name="user-storage" 
        value="{{storedUser}}"
        on-iron-localstorage-load="_storedUserLoad"></iron-localstorage>
    <app-data key="userData" data="{{storedUser}}"></app-data>

    <iron-ajax
      auto
      id="getGraphsAjax"
      content-type="application/json"
      url="http://54.144.112.150/api/selectUserGraphs"
      method="post"
      handle-as="json"
      on-response="handleGraphsResponse">
    </iron-ajax>

    <div class="card">
        <highcharts-chart 
            type="spline" 
            data='[[0,0],[1,7],[2,1],[3,6],[4,8],[5,6]]' 
            title='Absorbance vs Concentration' 
            x-zoom 
            x-label="Concentration" 
            y-label="Absorbance">
        </highcharts-chart>

        <div class="container">
            <p class="align-left">Station: <strong>[[storedUser.station]]</strong></p>
            <p class="align-right">As of <strong>date here</strong></p>
        </div>
    </div>
      
  </template>

  <script>
    Polymer({
      is: 'secret-graphs',

      _storedUserLoad: function() {
          console.log(this.storedUser);

          this.setGraphsRequestBody();// donÂ´t know if this is the correct place to call it, yet it asssures that the user has been loaded
      },

      setGraphsRequestBody: function() {
        if(this.storedUser) { 
          var body = {
            "pUserNameGraph" : "admin", // must change to storedUser.station
            "graphType" : "notUsedInDb", // must change to null
            "pUserName" : this.storedUser.name,
            "pPassword" : this.storedUser.password
          }
          this.$.getGraphsAjax.body = body;
        }
      },

      handleGraphsResponse : function(event) {
        var calibrationGraph = event.detail.response[0][0];
        var concentrationGraph = event.detail.response[0][2];
        console.log(calibrationGraph);// check for pearson, wavelength, intercept and slope here.
        console.log(concentrationGraph);

        //continiously update
         this.async(function() {
           this.$.getGraphsAjax.generateRequest();
         }, 5000);
      },

    });
  </script>
</dom-module>
